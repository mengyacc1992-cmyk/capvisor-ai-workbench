# 🚀 CapVisor AI Workbench 快速体验指南

## 方式一：Docker Compose（最简单，推荐）

### 前置要求
- 已安装 Docker 和 Docker Compose
- 已获取 Gemini API Key（从 Google AI Studio）

### 3 步启动

1. **配置环境变量**
   
   在项目根目录创建 `.env` 文件：
   ```bash
   GEMINI_API_KEY=你的_Gemini_API_Key
   USERS_JSON='[{"email":"demo@capvisor.ai","password":"capvisor123"}]'
   ```

2. **启动所有服务**
   ```bash
   cd services
   docker-compose up --build
   ```
   
   这会自动启动：
   - PostgreSQL 数据库（端口 5432）
   - 后端 API 服务（端口 8787）
   - 自动初始化数据库表结构
   - 自动创建默认用户账号

3. **启动前端**
   
   打开**新的终端窗口**，在项目根目录运行：
   ```bash
   npm install
   npm run dev
   ```
   
   前端会在 `http://localhost:3000` 启动

### 登录体验

1. 打开浏览器访问 `http://localhost:3000`
2. 使用默认账号登录：
   - **邮箱**: `demo@capvisor.ai`
   - **密码**: `capvisor123`
3. 开始使用：
   - 在 Parameter Deck 配置参数（脸型、帽型、场景等）
   - 点击 "GENERATE TOPICS" 生成选题
   - 选择选题进入 CAS Editor 编辑内容流
   - 生成图片和评分

---

## 方式二：本地开发（适合调试）

### 前置要求
- Node.js 20+
- PostgreSQL（或使用 Docker 只启动数据库）

### 启动步骤

1. **安装依赖**
   ```bash
   # 前端依赖
   npm install
   
   # 后端依赖
   cd services/server
   npm install
   ```

2. **配置后端环境变量**
   
   复制 `services/server/env.local.example` 为 `services/server/.env.local`：
   ```bash
   cd services/server
   cp env.local.example .env.local
   ```
   
   编辑 `.env.local`，填入：
   ```
   GEMINI_API_KEY=你的_Gemini_API_Key
   DATABASE_URL=postgres://postgres:postgres@localhost:5432/capvisor
   USERS_JSON='[{"email":"demo@capvisor.ai","password":"capvisor123"}]'
   JWT_SECRET=change-this-in-prod
   ```

3. **启动数据库（如果还没启动）**
   ```bash
   cd services
   docker-compose up db -d
   ```

4. **启动后端**
   ```bash
   cd services/server
   npm run build
   npm start
   ```
   
   后端会在 `http://localhost:8787` 启动

5. **启动前端**
   
   在项目根目录（新终端）：
   ```bash
   npm run dev
   ```
   
   前端会在 `http://localhost:3000` 启动

---

## 常见问题

### 1. 端口被占用
- 后端默认 8787，可在 `services/server/.env.local` 修改 `PORT`
- 前端默认 3000，可在 `vite.config.ts` 修改

### 2. 数据库连接失败
- 确保 PostgreSQL 已启动
- 检查 `DATABASE_URL` 配置是否正确
- 如果使用 Docker Compose，确保 `db` 服务已启动

### 3. 登录失败
- 检查 `USERS_JSON` 配置是否正确（JSON 格式）
- 默认账号：`demo@capvisor.ai` / `capvisor123`
- 可以添加更多账号，格式：
  ```json
  [
    {"email":"demo@capvisor.ai","password":"capvisor123"},
    {"email":"user2@capvisor.ai","password":"password2"}
  ]
  ```

### 4. API 调用失败
- 检查后端是否正常运行（访问 `http://localhost:8787/healthz`）
- 检查 `GEMINI_API_KEY` 是否有效
- 查看后端终端日志

### 5. 前端无法连接后端
- 检查 `services/services/apiClient.ts` 中的 `API_BASE`
- 默认是 `http://localhost:8787`
- 如果后端在不同端口，设置环境变量：`VITE_API_BASE=http://localhost:8787`

---

## 功能说明

### 核心流程
1. **Parameter Deck**：配置内容生成参数
   - 用户痛点（显脸大、头型扁塌等）
   - 场景（通勤、约会、度假等）
   - 脸型、性别、帽型
   - 内容页数、理论深度

2. **Topic Gallery**：AI 生成 8 个选题卡片
   - 每个选题包含标题、热度、摘要
   - 点击选题进入编辑

3. **CAS Editor**：内容资产流编辑器
   - 每页包含：视觉逻辑、英文 Prompt、标题、知识点、脚本
   - 可以生成图片、评分
   - 支持实时编辑和保存

### 多用户共享
- 所有用户共享同一个数据库
- 生成记录保存在 `generation_logs` 表
- 可以通过 `/api/logs` 查看历史记录

---

## 下一步

- 部署到生产环境（Railway、Render、Vercel 等）
- 配置对象存储（S3/GCS）存储图片
- 添加更多用户管理功能
- 优化 AI 生成质量

如有问题，查看 `services/README.md` 或检查后端日志。
